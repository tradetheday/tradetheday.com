---
export interface Props {
  title: string;
  icon?: string;
  id: string;
  expanded?: boolean;
  variant?: 'default' | 'dark';
}

const { 
  title, 
  icon = 'ðŸ“Š', 
  id,
  expanded = false,
  variant = 'default'
} = Astro.props;

const uniqueId = `analyst-${id}`;
const iconId = `icon-${id}`;
---

<div class={`analyst-notes ${variant}`}>
  <button 
    class="analyst-notes-button" 
    data-target={uniqueId}
    data-icon={iconId}
    aria-expanded={expanded ? 'true' : 'false'}
  >
    {icon} {title}
    <span id={iconId} class="analyst-notes-icon">{expanded ? 'â–²' : 'â–¼'}</span>
  </button>
  <div 
    id={uniqueId} 
    class="analyst-notes-content" 
    style={expanded ? 'display: block;' : 'display: none;'}
  >
    <slot />
  </div>
</div>

<script>
// Analyst Notes functionality
document.addEventListener('DOMContentLoaded', function() {
  const buttons = document.querySelectorAll('.analyst-notes-button');
  
  buttons.forEach(button => {
    button.addEventListener('click', function() {
      const targetId = this.getAttribute('data-target');
      const iconId = this.getAttribute('data-icon');
      const content = document.getElementById(targetId);
      const icon = document.getElementById(iconId);
      
      if (content && icon) {
        const isVisible = content.style.display === 'block';
        
        if (isVisible) {
          content.style.display = 'none';
          icon.textContent = 'â–¼';
          this.setAttribute('aria-expanded', 'false');
        } else {
          content.style.display = 'block';
          icon.textContent = 'â–²';
          this.setAttribute('aria-expanded', 'true');
        }
      }
    });
  });
});
</script>

<style>
.analyst-notes {
  margin: 2rem 0;
  border-radius: 1rem;
  overflow: hidden;
}

.analyst-notes-button {
  min-width: 500px;
  padding: 1rem 2rem;
  background: linear-gradient(135deg, #ff4800 0%, #e63e00 100%);
  color: white;
  border: none;
  border-radius: 0.75rem;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s ease;
  position: relative;
  margin: 0 auto 1rem auto;
  white-space: nowrap;
}

.analyst-notes-button:hover {
  background: linear-gradient(135deg, #e63e00 0%, #cc3700 100%);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(255, 72, 0, 0.3);
}

.analyst-notes-button:active {
  transform: translateY(0);
}

.analyst-notes-icon {
  font-size: 1.2rem;
  font-weight: bold;
  transition: transform 0.3s ease;
  margin-left: 1rem;
}

.analyst-notes-button[aria-expanded="true"] .analyst-notes-icon {
  transform: rotate(180deg);
}

.analyst-notes-content {
  padding: 2rem;
  background: var(--analyst-bg, linear-gradient(135deg, rgba(255, 72, 0, 0.08) 0%, rgba(255, 120, 40, 0.12) 50%, rgba(255, 180, 100, 0.06) 100%));
  animation: fadeIn 0.3s ease;
  border: 1px solid rgba(255, 72, 0, 0.2);
  border-radius: 1rem;
  box-shadow: 0 4px 20px rgba(255, 72, 0, 0.08);
}

.analyst-notes-content h3,
.analyst-notes-content h4,
.analyst-notes-content h5 {
  color: var(--charcoal, #1e2427);
  margin: 1.5rem 0 1rem 0;
}

.analyst-notes-content h3:first-child,
.analyst-notes-content h4:first-child,
.analyst-notes-content h5:first-child {
  margin-top: 0;
}

.analyst-notes-content p {
  margin-bottom: 1rem;
  line-height: 1.6;
  color: var(--gray-700, #374151);
}

.analyst-notes-content p:last-child {
  margin-bottom: 0;
}

.analyst-notes-content ul,
.analyst-notes-content ol {
  margin: 1rem 0;
  padding-left: 1.5rem;
}

.analyst-notes-content li {
  margin-bottom: 0.5rem;
  line-height: 1.6;
  color: var(--gray-700, #374151);
}

.analyst-notes-content strong {
  color: var(--charcoal, #1e2427);
  font-weight: 600;
}

/* Dark variant styles */
.analyst-notes.dark .analyst-notes-content {
  background: #fff5e6;
  border: 1px solid #ff8c00;
  box-shadow: 0 4px 20px rgba(255, 140, 0, 0.15);
}

.analyst-notes.dark .analyst-notes-content h3,
.analyst-notes.dark .analyst-notes-content h4,
.analyst-notes.dark .analyst-notes-content h5 {
  color: var(--charcoal, #1e2427);
}

.analyst-notes.dark .analyst-notes-content p {
  color: var(--gray-700, #374151);
}

.analyst-notes.dark .analyst-notes-content ul,
.analyst-notes.dark .analyst-notes-content ol {
  color: var(--gray-700, #374151);
}

.analyst-notes.dark .analyst-notes-content li {
  color: var(--gray-700, #374151);
}

.analyst-notes.dark .analyst-notes-content strong {
  color: var(--charcoal, #1e2427);
  font-weight: 600;
}

/* Dark variant grid and list styling */
.analyst-notes.dark .analyst-notes-content .grid-2 {
  color: var(--gray-700, #374151);
}

.analyst-notes.dark .analyst-notes-content .grid-2 h5 {
  color: var(--charcoal, #1e2427);
}

.analyst-notes.dark .analyst-notes-content .grid-2 ul {
  color: var(--gray-700, #374151);
}

.analyst-notes.dark .analyst-notes-content .grid-2 li {
  color: var(--gray-700, #374151);
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Mobile responsive */
@media (max-width: 768px) {
  .analyst-notes-button {
    min-width: 90%;
    max-width: 90%;
    padding: 1rem 1.5rem;
    font-size: 0.9rem;
    white-space: normal;
    text-align: left;
  }
  
  .analyst-notes-content {
    padding: 1.5rem;
  }
  
  .analyst-notes-icon {
    margin-left: 0.5rem;
  }
}

@media (max-width: 480px) {
  .analyst-notes-button {
    font-size: 0.8125rem;
    padding: 0.875rem 1.25rem;
  }
}
</style>