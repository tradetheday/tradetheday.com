---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { brokers, getBrokerBySlug, getBrokerComparisons, type BrokerData } from '../../data/brokers';

// Generate all comparison pages at build time
export async function getStaticPaths() {
  const comparisons = getBrokerComparisons();

  return comparisons.map(({ broker1, broker2, slug }) => ({
    params: { slug },
    props: { broker1, broker2 }
  }));
}

interface Props {
  broker1: BrokerData;
  broker2: BrokerData;
}

const { broker1, broker2 } = Astro.props;

// Determine winner for each category
function getWinner(b1: BrokerData, b2: BrokerData, category: keyof BrokerData['scores']): BrokerData | null {
  const score1 = b1.scores[category];
  const score2 = b2.scores[category];
  if (score1 > score2) return b1;
  if (score2 > score1) return b2;
  return null;
}

// Calculate overall winner
const overallWinner = getWinner(broker1, broker2, 'overall');

const pageTitle = `${broker1.name} vs ${broker2.name} - Which Broker is Better? (2026)`;
const pageDescription = `Compare ${broker1.name} and ${broker2.name} side-by-side. See fees, features, platforms, and regulation to find the best broker for your trading needs.`;
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <div class="compare-page">
    <!-- Hero Section -->
    <section class="compare-hero">
      <div class="container">
        <div class="compare-badge">BROKER COMPARISON</div>
        <h1 class="compare-title">
          {broker1.name} <span class="vs">vs</span> {broker2.name}
        </h1>
        <p class="compare-subtitle">
          An in-depth comparison to help you choose the right broker for your trading journey.
        </p>
      </div>
    </section>

    <!-- Quick Verdict -->
    <section class="verdict-section">
      <div class="container">
        <div class="verdict-box">
          <div class="verdict-header">
            <h2>Quick Verdict</h2>
          </div>
          <div class="verdict-grid">
            <div class={`verdict-card ${overallWinner?.id === broker1.id ? 'winner' : ''}`}>
              <img src={broker1.logo} alt={broker1.name} class="verdict-logo" />
              <div class="verdict-score">{broker1.scores.overall}/5</div>
              <div class="verdict-best-for">Best for: {broker1.bestFor[0]}</div>
              <a href={broker1.affiliateUrl} class="verdict-cta" target="_blank" rel="noopener">
                Visit {broker1.name}
              </a>
            </div>

            <div class="verdict-vs">VS</div>

            <div class={`verdict-card ${overallWinner?.id === broker2.id ? 'winner' : ''}`}>
              <img src={broker2.logo} alt={broker2.name} class="verdict-logo" />
              <div class="verdict-score">{broker2.scores.overall}/5</div>
              <div class="verdict-best-for">Best for: {broker2.bestFor[0]}</div>
              <a href={broker2.affiliateUrl} class="verdict-cta" target="_blank" rel="noopener">
                Visit {broker2.name}
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Detailed Comparison Table -->
    <section class="comparison-section">
      <div class="container">
        <h2 class="section-title">Side-by-Side Comparison</h2>

        <div class="comparison-table">
          <!-- Header Row -->
          <div class="table-header">
            <div class="table-cell feature-cell">Feature</div>
            <div class="table-cell broker-cell">
              <img src={broker1.logo} alt={broker1.name} class="table-logo" />
            </div>
            <div class="table-cell broker-cell">
              <img src={broker2.logo} alt={broker2.name} class="table-logo" />
            </div>
          </div>

          <!-- Overall Rating -->
          <div class="table-row">
            <div class="table-cell feature-cell">Overall Rating</div>
            <div class={`table-cell ${broker1.scores.overall > broker2.scores.overall ? 'winner-cell' : ''}`}>
              <span class="score-badge">{broker1.scores.overall}/5</span>
            </div>
            <div class={`table-cell ${broker2.scores.overall > broker1.scores.overall ? 'winner-cell' : ''}`}>
              <span class="score-badge">{broker2.scores.overall}/5</span>
            </div>
          </div>

          <!-- Minimum Deposit -->
          <div class="table-row">
            <div class="table-cell feature-cell">Minimum Deposit</div>
            <div class={`table-cell ${broker1.minDeposit < broker2.minDeposit ? 'winner-cell' : ''}`}>
              {broker1.minDepositDisplay}
            </div>
            <div class={`table-cell ${broker2.minDeposit < broker1.minDeposit ? 'winner-cell' : ''}`}>
              {broker2.minDepositDisplay}
            </div>
          </div>

          <!-- Spreads -->
          <div class="table-row">
            <div class="table-cell feature-cell">Spreads From</div>
            <div class="table-cell">{broker1.spreadsFrom}</div>
            <div class="table-cell">{broker2.spreadsFrom}</div>
          </div>

          <!-- Leverage -->
          <div class="table-row">
            <div class="table-cell feature-cell">Max Leverage</div>
            <div class="table-cell">{broker1.leverage}</div>
            <div class="table-cell">{broker2.leverage}</div>
          </div>

          <!-- Instruments -->
          <div class="table-row">
            <div class="table-cell feature-cell">Instruments</div>
            <div class={`table-cell ${broker1.instruments > broker2.instruments ? 'winner-cell' : ''}`}>
              {broker1.instrumentsDisplay}
            </div>
            <div class={`table-cell ${broker2.instruments > broker1.instruments ? 'winner-cell' : ''}`}>
              {broker2.instrumentsDisplay}
            </div>
          </div>

          <!-- Fees Score -->
          <div class="table-row">
            <div class="table-cell feature-cell">Fees Score</div>
            <div class={`table-cell ${broker1.scores.fees > broker2.scores.fees ? 'winner-cell' : ''}`}>
              {broker1.scores.fees}/5
            </div>
            <div class={`table-cell ${broker2.scores.fees > broker1.scores.fees ? 'winner-cell' : ''}`}>
              {broker2.scores.fees}/5
            </div>
          </div>

          <!-- Platforms Score -->
          <div class="table-row">
            <div class="table-cell feature-cell">Platforms Score</div>
            <div class={`table-cell ${broker1.scores.platforms > broker2.scores.platforms ? 'winner-cell' : ''}`}>
              {broker1.scores.platforms}/5
            </div>
            <div class={`table-cell ${broker2.scores.platforms > broker1.scores.platforms ? 'winner-cell' : ''}`}>
              {broker2.scores.platforms}/5
            </div>
          </div>

          <!-- Education Score -->
          <div class="table-row">
            <div class="table-cell feature-cell">Education Score</div>
            <div class={`table-cell ${broker1.scores.education > broker2.scores.education ? 'winner-cell' : ''}`}>
              {broker1.scores.education}/5
            </div>
            <div class={`table-cell ${broker2.scores.education > broker1.scores.education ? 'winner-cell' : ''}`}>
              {broker2.scores.education}/5
            </div>
          </div>

          <!-- Safety Score -->
          <div class="table-row">
            <div class="table-cell feature-cell">Safety Score</div>
            <div class={`table-cell ${broker1.scores.safety > broker2.scores.safety ? 'winner-cell' : ''}`}>
              {broker1.scores.safety}/5
            </div>
            <div class={`table-cell ${broker2.scores.safety > broker1.scores.safety ? 'winner-cell' : ''}`}>
              {broker2.scores.safety}/5
            </div>
          </div>

          <!-- Platforms -->
          <div class="table-row">
            <div class="table-cell feature-cell">Platforms</div>
            <div class="table-cell platform-cell">{broker1.platforms.join(', ')}</div>
            <div class="table-cell platform-cell">{broker2.platforms.join(', ')}</div>
          </div>

          <!-- Founded -->
          <div class="table-row">
            <div class="table-cell feature-cell">Founded</div>
            <div class="table-cell">{broker1.foundingYear}</div>
            <div class="table-cell">{broker2.foundingYear}</div>
          </div>

          <!-- Headquarters -->
          <div class="table-row">
            <div class="table-cell feature-cell">Headquarters</div>
            <div class="table-cell">{broker1.headquarters.city}, {broker1.headquarters.country}</div>
            <div class="table-cell">{broker2.headquarters.city}, {broker2.headquarters.country}</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Pros and Cons -->
    <section class="pros-cons-section">
      <div class="container">
        <h2 class="section-title">Pros & Cons</h2>

        <div class="pros-cons-grid">
          <!-- Broker 1 -->
          <div class="pros-cons-card">
            <div class="pc-header">
              <img src={broker1.logo} alt={broker1.name} class="pc-logo" />
            </div>
            <div class="pros-list">
              <h3>Pros</h3>
              <ul>
                {broker1.pros.map(pro => (
                  <li><span class="pro-icon">+</span> {pro}</li>
                ))}
              </ul>
            </div>
            <div class="cons-list">
              <h3>Cons</h3>
              <ul>
                {broker1.cons.map(con => (
                  <li><span class="con-icon">-</span> {con}</li>
                ))}
              </ul>
            </div>
            <a href={broker1.affiliateUrl} class="pc-cta" target="_blank" rel="noopener">
              Open {broker1.name} Account
            </a>
          </div>

          <!-- Broker 2 -->
          <div class="pros-cons-card">
            <div class="pc-header">
              <img src={broker2.logo} alt={broker2.name} class="pc-logo" />
            </div>
            <div class="pros-list">
              <h3>Pros</h3>
              <ul>
                {broker2.pros.map(pro => (
                  <li><span class="pro-icon">+</span> {pro}</li>
                ))}
              </ul>
            </div>
            <div class="cons-list">
              <h3>Cons</h3>
              <ul>
                {broker2.cons.map(con => (
                  <li><span class="con-icon">-</span> {con}</li>
                ))}
              </ul>
            </div>
            <a href={broker2.affiliateUrl} class="pc-cta" target="_blank" rel="noopener">
              Open {broker2.name} Account
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Who Should Choose -->
    <section class="recommendation-section">
      <div class="container">
        <h2 class="section-title">Our Recommendation</h2>

        <div class="recommendation-grid">
          <div class="rec-card">
            <div class="rec-header">
              <span class="rec-choose">Choose</span>
              <img src={broker1.logo} alt={broker1.name} class="rec-logo" />
            </div>
            <p class="rec-if">If you:</p>
            <ul class="rec-list">
              {broker1.bestFor.map(item => (
                <li>{item}</li>
              ))}
            </ul>
            <a href={broker1.affiliateUrl} class="rec-cta" target="_blank" rel="noopener">
              Visit {broker1.name} ‚Üí
            </a>
          </div>

          <div class="rec-card">
            <div class="rec-header">
              <span class="rec-choose">Choose</span>
              <img src={broker2.logo} alt={broker2.name} class="rec-logo" />
            </div>
            <p class="rec-if">If you:</p>
            <ul class="rec-list">
              {broker2.bestFor.map(item => (
                <li>{item}</li>
              ))}
            </ul>
            <a href={broker2.affiliateUrl} class="rec-cta" target="_blank" rel="noopener">
              Visit {broker2.name} ‚Üí
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Free Trading Tools -->
    <section class="tools-cta-section">
      <div class="container">
        <div class="tools-cta-box">
          <h2>Calculate Your Trading Costs</h2>
          <p>Use our free tools to compare broker costs and calculate position sizes before you trade.</p>
          <div class="tools-cta-grid">
            <a href="/tools/broker-calculator/" class="tool-cta-card">
              <span class="tool-cta-icon">üßÆ</span>
              <span class="tool-cta-title">Broker Cost Calculator</span>
              <span class="tool-cta-desc">Compare total trading costs</span>
            </a>
            <a href="/tools/position-calculator/" class="tool-cta-card">
              <span class="tool-cta-icon">üìê</span>
              <span class="tool-cta-title">Position Size Calculator</span>
              <span class="tool-cta-desc">Calculate proper lot sizes</span>
            </a>
            <a href="/tools/profit-calculator/" class="tool-cta-card">
              <span class="tool-cta-icon">üí∞</span>
              <span class="tool-cta-title">Profit/Loss Calculator</span>
              <span class="tool-cta-desc">Know your P&L in advance</span>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Other Comparisons -->
    <section class="other-comparisons">
      <div class="container">
        <h2 class="section-title">More Broker Comparisons</h2>
        <div class="other-grid">
          {getBrokerComparisons()
            .filter(c => c.broker1.id !== broker1.id && c.broker2.id !== broker2.id)
            .slice(0, 6)
            .map(comp => (
              <a href={`/compare/${comp.slug}/`} class="other-card">
                <span>{comp.broker1.name}</span>
                <span class="other-vs">vs</span>
                <span>{comp.broker2.name}</span>
              </a>
            ))
          }
        </div>
      </div>
    </section>
  </div>

  <style>
    .compare-page {
      background: var(--black);
    }

    /* Hero */
    .compare-hero {
      padding: var(--space-3xl) 0 var(--space-xl);
      text-align: center;
      background: linear-gradient(180deg, rgba(255, 72, 0, 0.1) 0%, transparent 100%);
    }

    .compare-badge {
      display: inline-block;
      background: var(--gray-800);
      color: var(--text-secondary);
      padding: var(--space-xs) var(--space-md);
      border-radius: 100px;
      font-size: var(--text-xs);
      font-weight: 700;
      margin-bottom: var(--space-md);
      letter-spacing: 0.1em;
    }

    .compare-title {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 800;
      margin-bottom: var(--space-md);
    }

    .compare-title .vs {
      color: var(--orange);
      font-size: 0.6em;
      margin: 0 var(--space-sm);
    }

    .compare-subtitle {
      font-size: var(--text-lg);
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Verdict Section */
    .verdict-section {
      padding: var(--space-xl) 0;
    }

    .verdict-box {
      background: var(--gray-900);
      border: 1px solid var(--gray-800);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
    }

    .verdict-header h2 {
      text-align: center;
      font-size: var(--text-xl);
      margin-bottom: var(--space-xl);
    }

    .verdict-grid {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: var(--space-lg);
      align-items: center;
    }

    @media (max-width: 768px) {
      .verdict-grid {
        grid-template-columns: 1fr;
      }
    }

    .verdict-card {
      background: var(--gray-800);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      text-align: center;
      border: 2px solid transparent;
    }

    .verdict-card.winner {
      border-color: var(--orange);
      background: linear-gradient(135deg, rgba(255, 72, 0, 0.1) 0%, var(--gray-800) 100%);
    }

    .verdict-logo {
      height: 48px;
      width: auto;
      filter: brightness(0) invert(1);
      margin-bottom: var(--space-md);
    }

    .verdict-score {
      font-size: var(--text-2xl);
      font-weight: 800;
      color: var(--orange);
      margin-bottom: var(--space-sm);
    }

    .verdict-best-for {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      margin-bottom: var(--space-lg);
    }

    .verdict-cta {
      display: inline-block;
      padding: var(--space-sm) var(--space-lg);
      background: var(--orange);
      color: var(--white);
      border-radius: var(--radius-md);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
    }

    .verdict-cta:hover {
      background: var(--orange-dark);
    }

    .verdict-vs {
      font-size: var(--text-2xl);
      font-weight: 800;
      color: var(--gray-600);
    }

    /* Comparison Table */
    .comparison-section {
      padding: var(--space-2xl) 0;
    }

    .section-title {
      font-size: var(--text-2xl);
      font-weight: 700;
      text-align: center;
      margin-bottom: var(--space-xl);
    }

    .comparison-table {
      background: var(--gray-900);
      border-radius: var(--radius-xl);
      overflow: hidden;
      border: 1px solid var(--gray-800);
    }

    .table-header {
      display: grid;
      grid-template-columns: 1.5fr 1fr 1fr;
      background: var(--gray-800);
    }

    .table-row {
      display: grid;
      grid-template-columns: 1.5fr 1fr 1fr;
      border-bottom: 1px solid var(--gray-800);
    }

    .table-row:last-child {
      border-bottom: none;
    }

    .table-cell {
      padding: var(--space-md) var(--space-lg);
      display: flex;
      align-items: center;
    }

    .feature-cell {
      font-weight: 600;
      color: var(--text-secondary);
    }

    .broker-cell {
      justify-content: center;
    }

    .table-logo {
      height: 32px;
      width: auto;
      filter: brightness(0) invert(1);
    }

    .table-cell:not(.feature-cell) {
      justify-content: center;
      text-align: center;
    }

    .winner-cell {
      background: rgba(255, 72, 0, 0.1);
      color: var(--orange);
      font-weight: 600;
    }

    .score-badge {
      background: var(--gray-800);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      font-weight: 700;
    }

    .winner-cell .score-badge {
      background: var(--orange);
      color: var(--white);
    }

    .platform-cell {
      font-size: var(--text-sm);
    }

    /* Pros and Cons */
    .pros-cons-section {
      padding: var(--space-2xl) 0;
      background: var(--gray-950);
    }

    .pros-cons-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-xl);
    }

    @media (max-width: 768px) {
      .pros-cons-grid {
        grid-template-columns: 1fr;
      }
    }

    .pros-cons-card {
      background: var(--gray-900);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      border: 1px solid var(--gray-800);
    }

    .pc-header {
      text-align: center;
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-lg);
      border-bottom: 1px solid var(--gray-800);
    }

    .pc-logo {
      height: 40px;
      filter: brightness(0) invert(1);
    }

    .pros-list h3,
    .cons-list h3 {
      font-size: var(--text-md);
      margin-bottom: var(--space-sm);
    }

    .pros-list ul,
    .cons-list ul {
      list-style: none;
      padding: 0;
      margin: 0 0 var(--space-lg) 0;
    }

    .pros-list li,
    .cons-list li {
      display: flex;
      gap: var(--space-sm);
      margin-bottom: var(--space-sm);
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .pro-icon {
      color: #10b981;
      font-weight: bold;
    }

    .con-icon {
      color: #ef4444;
      font-weight: bold;
    }

    .pc-cta {
      display: block;
      width: 100%;
      padding: var(--space-md);
      background: var(--orange);
      color: var(--white);
      border-radius: var(--radius-md);
      text-align: center;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
    }

    .pc-cta:hover {
      background: var(--orange-dark);
    }

    /* Recommendation */
    .recommendation-section {
      padding: var(--space-2xl) 0;
    }

    .recommendation-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-xl);
    }

    @media (max-width: 768px) {
      .recommendation-grid {
        grid-template-columns: 1fr;
      }
    }

    .rec-card {
      background: var(--gray-900);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      border: 1px solid var(--gray-800);
    }

    .rec-header {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-md);
    }

    .rec-choose {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .rec-logo {
      height: 32px;
      filter: brightness(0) invert(1);
    }

    .rec-if {
      font-weight: 600;
      margin-bottom: var(--space-sm);
    }

    .rec-list {
      list-style: none;
      padding: 0;
      margin: 0 0 var(--space-lg) 0;
    }

    .rec-list li {
      position: relative;
      padding-left: var(--space-lg);
      margin-bottom: var(--space-sm);
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .rec-list li::before {
      content: "‚Üí";
      position: absolute;
      left: 0;
      color: var(--orange);
    }

    .rec-cta {
      display: inline-block;
      color: var(--orange);
      text-decoration: none;
      font-weight: 600;
    }

    .rec-cta:hover {
      text-decoration: underline;
    }

    /* Other Comparisons */
    .other-comparisons {
      padding: var(--space-2xl) 0;
      background: var(--gray-950);
    }

    .other-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-md);
    }

    @media (max-width: 768px) {
      .other-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 500px) {
      .other-grid {
        grid-template-columns: 1fr;
      }
    }

    .other-card {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      padding: var(--space-md);
      background: var(--gray-900);
      border: 1px solid var(--gray-800);
      border-radius: var(--radius-md);
      text-decoration: none;
      color: var(--white);
      font-weight: 600;
      font-size: var(--text-sm);
      transition: all 0.2s;
    }

    .other-card:hover {
      border-color: var(--orange);
      background: var(--gray-800);
    }

    .other-vs {
      color: var(--orange);
      font-size: var(--text-xs);
    }

    /* Tools CTA Section */
    .tools-cta-section {
      padding: var(--space-xl) 0;
      background: var(--gray-950);
    }

    .tools-cta-box {
      text-align: center;
      padding: var(--space-2xl);
      background: linear-gradient(135deg, rgba(255, 72, 0, 0.08) 0%, var(--gray-900) 100%);
      border: 1px solid rgba(255, 72, 0, 0.2);
      border-radius: var(--radius-xl);
    }

    .tools-cta-box h2 {
      font-size: var(--text-xl);
      margin-bottom: var(--space-sm);
    }

    .tools-cta-box p {
      color: var(--text-secondary);
      margin-bottom: var(--space-xl);
    }

    .tools-cta-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-md);
    }

    @media (max-width: 768px) {
      .tools-cta-grid {
        grid-template-columns: 1fr;
      }
    }

    .tool-cta-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-lg);
      background: var(--gray-800);
      border: 1px solid var(--gray-700);
      border-radius: var(--radius-lg);
      text-decoration: none;
      transition: all 0.2s;
    }

    .tool-cta-card:hover {
      border-color: var(--orange);
      transform: translateY(-2px);
    }

    .tool-cta-icon {
      font-size: 2rem;
    }

    .tool-cta-title {
      font-weight: 700;
      color: var(--white);
    }

    .tool-cta-desc {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }
  </style>
</BaseLayout>
