---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import '../../../styles/tools.css';

const pageTitle = "Forex Profit Calculator (Free): Know Your P/L Before You Trade";
const pageDescription = "Free profit/loss calculator for forex. Enter entry, exit, and lot size to see exact profit in pips and dollars. Calculate risk:reward ratio instantly.";

const breadcrumbItems = [
  { text: 'Home', href: '/' },
  { text: 'Tools', href: '/tools/' },
  { text: 'Profit Calculator', current: true }
];
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <Fragment slot="breadcrumb">
    <Breadcrumb items={breadcrumbItems} />
  </Fragment>

  <div class="tool-page">
    <!-- Hero -->
    <section class="tool-hero">
      <div class="container">
        <div class="tool-hero-badge"><span aria-hidden="true">üí∞</span> P&L CALCULATOR</div>
        <h1 class="tool-hero-title">Profit & Loss Calculator</h1>
        <p class="tool-hero-subtitle">Know your potential profit and loss before you click buy or sell. Make smarter trading decisions.</p>
      </div>
    </section>

    <!-- Calculator -->
    <section class="calculator-section">
      <div class="container">
        <div class="calculator-container">
          <!-- Inputs -->
          <div class="calc-inputs">
            <h2 class="calc-section-title">Trade Setup</h2>

            <div class="input-group">
              <label class="input-label">
                <span class="label-icon">üìà</span>
                Trade Direction
              </label>
              <div class="direction-buttons" id="directionSelector">
                <button class="direction-btn buy active" data-direction="buy">
                  <span class="dir-icon">üü¢</span>
                  <span class="dir-name">BUY (Long)</span>
                </button>
                <button class="direction-btn sell" data-direction="sell">
                  <span class="dir-icon">üî¥</span>
                  <span class="dir-name">SELL (Short)</span>
                </button>
              </div>
            </div>

            <div class="input-group">
              <label class="input-label">
                <span class="label-icon">üí±</span>
                Currency Pair
              </label>
              <div class="pair-buttons" id="pairSelector">
                <button class="pair-btn active" data-pair="eurusd" data-pipvalue="10">EUR/USD</button>
                <button class="pair-btn" data-pair="gbpusd" data-pipvalue="10">GBP/USD</button>
                <button class="pair-btn" data-pair="usdjpy" data-pipvalue="7.5">USD/JPY</button>
                <button class="pair-btn" data-pair="gold" data-pipvalue="10">Gold</button>
              </div>
            </div>

            <div class="input-row">
              <div class="input-group half">
                <label class="input-label" for="entryPrice">
                  <span class="label-icon">üéØ</span>
                  Entry Price
                </label>
                <input type="number" id="entryPrice" value="1.0850" step="0.0001" class="price-input">
              </div>

              <div class="input-group half">
                <label class="input-label" for="lotSize">
                  <span class="label-icon">üìä</span>
                  Position Size (Lots)
                </label>
                <input type="number" id="lotSize" value="1.00" step="0.01" min="0.01" class="price-input">
              </div>
            </div>

            <div class="input-row">
              <div class="input-group half">
                <label class="input-label" for="stopLoss">
                  <span class="label-icon">üõë</span>
                  Stop Loss Price
                </label>
                <input type="number" id="stopLoss" value="1.0800" step="0.0001" class="price-input sl-input">
              </div>

              <div class="input-group half">
                <label class="input-label" for="takeProfit">
                  <span class="label-icon">üéØ</span>
                  Take Profit Price
                </label>
                <input type="number" id="takeProfit" value="1.0950" step="0.0001" class="price-input tp-input">
              </div>
            </div>

            <div class="quick-setups">
              <span class="quick-label">Quick R:R Setups:</span>
              <button class="quick-btn" data-rr="1">1:1</button>
              <button class="quick-btn" data-rr="2">1:2</button>
              <button class="quick-btn" data-rr="3">1:3</button>
            </div>
          </div>

          <!-- Results -->
          <div class="calc-results">
            <h2 class="calc-section-title">Trade Analysis</h2>

            <!-- Visual Price Chart -->
            <div class="price-visual">
              <div class="price-bar">
                <div class="price-marker tp" id="tpMarker">
                  <span class="marker-label">TP</span>
                  <span class="marker-price" id="tpPrice">1.0950</span>
                </div>
                <div class="price-marker entry" id="entryMarker">
                  <span class="marker-label">ENTRY</span>
                  <span class="marker-price" id="entryPriceDisplay">1.0850</span>
                </div>
                <div class="price-marker sl" id="slMarker">
                  <span class="marker-label">SL</span>
                  <span class="marker-price" id="slPrice">1.0800</span>
                </div>
                <div class="price-fill profit" id="profitFill"></div>
                <div class="price-fill loss" id="lossFill"></div>
              </div>
            </div>

            <!-- P&L Cards -->
            <div class="pnl-cards">
              <div class="pnl-card profit">
                <div class="pnl-label">Potential Profit</div>
                <div class="pnl-value" id="profitValue">+$1,000.00</div>
                <div class="pnl-pips" id="profitPips">+100 pips</div>
              </div>
              <div class="pnl-card loss">
                <div class="pnl-label">Potential Loss</div>
                <div class="pnl-value" id="lossValue">-$500.00</div>
                <div class="pnl-pips" id="lossPips">-50 pips</div>
              </div>
            </div>

            <!-- R:R Ratio -->
            <div class="rr-section">
              <div class="rr-display">
                <span class="rr-label">Reward:Risk Ratio</span>
                <span class="rr-value" id="rrRatio">1:2</span>
              </div>
              <div class="rr-bar">
                <div class="rr-risk" id="rrRiskBar" style="width: 33%"></div>
                <div class="rr-reward" id="rrRewardBar" style="width: 67%"></div>
              </div>
              <div class="rr-verdict" id="rrVerdict">
                <span class="verdict-icon">‚úÖ</span>
                <span class="verdict-text">Good trade setup! Risk is well managed.</span>
              </div>
            </div>

            <!-- Breakeven Info -->
            <div class="breakeven-card">
              <div class="breakeven-item">
                <span class="be-label">Win Rate Needed to Break Even</span>
                <span class="be-value" id="winRate">33%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Understanding R:R -->
    <section class="rr-education">
      <div class="container">
        <h2 class="section-title">Understanding Reward:Risk Ratio</h2>
        <div class="rr-grid">
          <div class="rr-card">
            <div class="rr-example bad">1:1</div>
            <h3>Break Even Trading</h3>
            <p>You need 50% win rate to break even. Not recommended for most traders.</p>
          </div>
          <div class="rr-card">
            <div class="rr-example okay">1:2</div>
            <h3>Minimum Standard</h3>
            <p>You only need 33% win rate. A 50% win rate makes you highly profitable.</p>
          </div>
          <div class="rr-card featured">
            <div class="rr-example good">1:3</div>
            <h3>Ideal Setup</h3>
            <p>Professional traders aim for 1:3 or better. You can be wrong 75% of the time and still profit.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="calc-cta-section">
      <div class="container">
        <div class="calc-cta-box">
          <div class="cta-content">
            <h2>Start Trading with Confidence</h2>
            <p>Open an AvaTrade account and use their advanced charting to plan your trades.</p>
          </div>
          <a href="https://www.avatrade.com/?tag=tradetheday" class="calc-cta-button" target="_blank" rel="noopener">
            Open AvaTrade Account
            <span class="cta-arrow">‚Üí</span>
          </a>
        </div>
      </div>
    </section>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const directionBtns = document.querySelectorAll('.direction-btn');
      const pairBtns = document.querySelectorAll('.pair-btn');
      const entryPrice = document.getElementById('entryPrice');
      const lotSize = document.getElementById('lotSize');
      const stopLoss = document.getElementById('stopLoss');
      const takeProfit = document.getElementById('takeProfit');
      const quickBtns = document.querySelectorAll('.quick-btn');

      let state = {
        direction: 'buy',
        pair: 'eurusd',
        pipValue: 10,
        entry: 1.0850,
        lots: 1.00,
        sl: 1.0800,
        tp: 1.0950
      };

      function calculate() {
        const pipMultiplier = state.pair === 'usdjpy' ? 100 : 10000;

        let slPips, tpPips;

        if (state.direction === 'buy') {
          slPips = (state.entry - state.sl) * pipMultiplier;
          tpPips = (state.tp - state.entry) * pipMultiplier;
        } else {
          slPips = (state.sl - state.entry) * pipMultiplier;
          tpPips = (state.entry - state.tp) * pipMultiplier;
        }

        const lossAmount = slPips * state.pipValue * state.lots;
        const profitAmount = tpPips * state.pipValue * state.lots;

        const rr = slPips > 0 ? (tpPips / slPips).toFixed(1) : 0;
        const winRateNeeded = slPips > 0 ? (1 / (1 + (tpPips / slPips))) * 100 : 50;

        // Update displays
        document.getElementById('profitValue').textContent = `+$${profitAmount.toFixed(2)}`;
        document.getElementById('profitPips').textContent = `+${tpPips.toFixed(0)} pips`;
        document.getElementById('lossValue').textContent = `-$${lossAmount.toFixed(2)}`;
        document.getElementById('lossPips').textContent = `-${slPips.toFixed(0)} pips`;
        document.getElementById('rrRatio').textContent = `1:${rr}`;
        document.getElementById('winRate').textContent = `${winRateNeeded.toFixed(0)}%`;

        // Update price visual markers
        document.getElementById('tpPrice').textContent = state.tp.toFixed(4);
        document.getElementById('entryPriceDisplay').textContent = state.entry.toFixed(4);
        document.getElementById('slPrice').textContent = state.sl.toFixed(4);

        // Update R:R bar
        const totalPips = slPips + tpPips;
        const riskPercent = (slPips / totalPips) * 100;
        const rewardPercent = (tpPips / totalPips) * 100;
        document.getElementById('rrRiskBar').style.width = `${riskPercent}%`;
        document.getElementById('rrRewardBar').style.width = `${rewardPercent}%`;

        // Update verdict
        const verdict = document.getElementById('rrVerdict');
        if (rr >= 3) {
          verdict.innerHTML = '<span class="verdict-icon">üéØ</span><span class="verdict-text">Excellent setup! Professional-grade risk management.</span>';
          verdict.className = 'rr-verdict excellent';
        } else if (rr >= 2) {
          verdict.innerHTML = '<span class="verdict-icon">‚úÖ</span><span class="verdict-text">Good trade setup! Risk is well managed.</span>';
          verdict.className = 'rr-verdict good';
        } else if (rr >= 1) {
          verdict.innerHTML = '<span class="verdict-icon">‚ö†Ô∏è</span><span class="verdict-text">Acceptable, but consider finding better entries.</span>';
          verdict.className = 'rr-verdict okay';
        } else {
          verdict.innerHTML = '<span class="verdict-icon">‚ùå</span><span class="verdict-text">Poor setup. Risk outweighs reward.</span>';
          verdict.className = 'rr-verdict bad';
        }
      }

      // Event listeners
      directionBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          directionBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.direction = btn.dataset.direction;
          calculate();
        });
      });

      pairBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          pairBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.pair = btn.dataset.pair;
          state.pipValue = parseFloat(btn.dataset.pipvalue);
          calculate();
        });
      });

      entryPrice.addEventListener('input', (e) => {
        state.entry = parseFloat(e.target.value) || 0;
        calculate();
      });

      lotSize.addEventListener('input', (e) => {
        state.lots = parseFloat(e.target.value) || 0.01;
        calculate();
      });

      stopLoss.addEventListener('input', (e) => {
        state.sl = parseFloat(e.target.value) || 0;
        calculate();
      });

      takeProfit.addEventListener('input', (e) => {
        state.tp = parseFloat(e.target.value) || 0;
        calculate();
      });

      quickBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const rr = parseFloat(btn.dataset.rr);
          const pipMultiplier = state.pair === 'usdjpy' ? 100 : 10000;
          const slDistance = Math.abs(state.entry - state.sl);

          if (state.direction === 'buy') {
            state.tp = state.entry + (slDistance * rr);
          } else {
            state.tp = state.entry - (slDistance * rr);
          }

          takeProfit.value = state.tp.toFixed(4);
          calculate();
        });
      });

      // Initial calculation
      calculate();
    });
  </script>

  <style>
    /* Color opacity variants - matching design system semantic colors */
    :root {
      --success-10: var(--success-10);
      --success-20: var(--success-20);
      --success-30: var(--success-30);
      --success-50: var(--success-50);
      --error-10: var(--error-10);
      --error-20: var(--error-20);
      --error-30: var(--error-30);
      --error-50: var(--error-50);
      --warning-10: rgba(255, 193, 7, 0.1);
      --warning-20: rgba(255, 193, 7, 0.2);
    }

    /* Calculator - Page-specific styles (hero from tools.css) */
    .calculator-section {
      padding: var(--space-xl) 0 var(--space-3xl);
    }

    .calculator-container {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: var(--space-2xl);
      align-items: start;
    }

    @media (max-width: 968px) {
      .calculator-container {
        grid-template-columns: 1fr;
      }
    }

    .calc-section-title {
      font-size: var(--text-xl);
      font-weight: 700;
      margin-bottom: var(--space-lg);
      color: var(--white);
    }

    .calc-inputs {
      background: var(--gray-900);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      border: 1px solid var(--gray-800);
    }

    .input-group {
      margin-bottom: var(--space-lg);
    }

    .input-group.half {
      margin-bottom: 0;
    }

    .input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }

    .input-label {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-weight: 600;
      margin-bottom: var(--space-sm);
      color: var(--white);
      font-size: var(--text-sm);
    }

    .label-icon {
      font-size: var(--text-md);
    }

    /* Direction Buttons */
    .direction-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-sm);
    }

    .direction-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      padding: var(--space-md);
      background: var(--gray-800);
      border: 2px solid var(--gray-700);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s;
    }

    .direction-btn.buy:hover, .direction-btn.buy.active {
      border-color: var(--success);
      background: var(--success-10);
    }

    .direction-btn.sell:hover, .direction-btn.sell.active {
      border-color: var(--error);
      background: var(--error-10);
    }

    .dir-icon {
      font-size: 1.25rem;
    }

    .dir-name {
      font-weight: 700;
      color: var(--white);
    }

    /* Pair Buttons */
    .pair-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
    }

    .pair-btn {
      padding: var(--space-sm) var(--space-md);
      background: var(--gray-800);
      border: 2px solid var(--gray-700);
      border-radius: var(--radius-md);
      color: var(--white);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .pair-btn:hover {
      border-color: var(--orange);
    }

    .pair-btn.active {
      background: var(--orange);
      border-color: var(--orange);
    }

    /* Price Input */
    .price-input {
      width: 100%;
      padding: var(--space-md);
      background: var(--gray-800);
      border: 2px solid var(--gray-700);
      border-radius: var(--radius-md);
      color: var(--white);
      font-size: var(--text-lg);
      font-weight: 600;
      font-family: monospace;
    }

    .price-input:focus {
      outline: none;
      border-color: var(--orange);
    }

    .sl-input {
      border-color: var(--error-50);
    }

    .tp-input {
      border-color: var(--success-50);
    }

    /* Quick Setups */
    .quick-setups {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }

    .quick-label {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .quick-btn {
      padding: var(--space-xs) var(--space-md);
      background: var(--gray-800);
      border: 1px solid var(--gray-700);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: var(--text-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-btn:hover {
      border-color: var(--orange);
      color: var(--white);
    }

    /* Results */
    .calc-results {
      background: var(--gray-900);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      border: 1px solid var(--gray-800);
    }

    /* Price Visual */
    .price-visual {
      margin-bottom: var(--space-xl);
      padding: var(--space-lg);
      background: var(--gray-800);
      border-radius: var(--radius-lg);
    }

    .price-bar {
      position: relative;
      height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .price-marker {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-sm);
      font-weight: 600;
    }

    .price-marker.tp {
      background: var(--success-20);
      border-left: 3px solid var(--success);
    }

    .price-marker.entry {
      background: rgba(255, 255, 255, 0.1);
      border-left: 3px solid var(--white);
    }

    .price-marker.sl {
      background: var(--error-20);
      border-left: 3px solid var(--error);
    }

    .marker-label {
      font-size: var(--text-xs);
      color: var(--text-secondary);
    }

    .marker-price {
      font-family: monospace;
      color: var(--white);
    }

    /* P&L Cards */
    .pnl-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }

    .pnl-card {
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      text-align: center;
    }

    .pnl-card.profit {
      background: var(--success-10);
      border: 1px solid var(--success-30);
    }

    .pnl-card.loss {
      background: var(--error-10);
      border: 1px solid var(--error-30);
    }

    .pnl-label {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      margin-bottom: var(--space-xs);
    }

    .pnl-value {
      font-size: var(--text-2xl);
      font-weight: 800;
    }

    .pnl-card.profit .pnl-value {
      color: var(--success);
    }

    .pnl-card.loss .pnl-value {
      color: var(--error);
    }

    .pnl-pips {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    /* R:R Section */
    .rr-section {
      padding: var(--space-lg);
      background: var(--gray-800);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-lg);
    }

    .rr-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
    }

    .rr-label {
      color: var(--text-secondary);
    }

    .rr-value {
      font-size: var(--text-xl);
      font-weight: 800;
      color: var(--orange);
    }

    .rr-bar {
      display: flex;
      height: 12px;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: var(--space-md);
    }

    .rr-risk {
      background: var(--error);
    }

    .rr-reward {
      background: var(--success);
    }

    .rr-verdict {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
    }

    .rr-verdict.excellent {
      background: var(--success-10);
      color: var(--success);
    }

    .rr-verdict.good {
      background: var(--success-10);
      color: var(--success);
    }

    .rr-verdict.okay {
      background: var(--warning-10);
      color: var(--warning);
    }

    .rr-verdict.bad {
      background: var(--error-10);
      color: var(--error);
    }

    /* Breakeven */
    .breakeven-card {
      padding: var(--space-md);
      background: var(--gray-800);
      border-radius: var(--radius-md);
    }

    .breakeven-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .be-label {
      color: var(--text-secondary);
      font-size: var(--text-sm);
    }

    .be-value {
      font-weight: 700;
      color: var(--white);
    }

    /* R:R Education */
    .rr-education {
      padding: var(--space-3xl) 0;
      background: var(--gray-950);
    }

    .section-title {
      font-size: var(--text-2xl);
      font-weight: 700;
      text-align: center;
      margin-bottom: var(--space-2xl);
    }

    .rr-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-xl);
    }

    @media (max-width: 768px) {
      .rr-grid {
        grid-template-columns: 1fr;
      }
    }

    .rr-card {
      padding: var(--space-xl);
      background: var(--gray-900);
      border-radius: var(--radius-lg);
      border: 1px solid var(--gray-800);
      text-align: center;
    }

    .rr-card.featured {
      border-color: var(--orange);
      background: linear-gradient(135deg, rgba(255, 72, 0, 0.1) 0%, var(--gray-900) 100%);
    }

    .rr-example {
      display: inline-block;
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-md);
      font-size: var(--text-2xl);
      font-weight: 800;
      margin-bottom: var(--space-md);
    }

    .rr-example.bad {
      background: var(--error-20);
      color: var(--error);
    }

    .rr-example.okay {
      background: var(--warning-20);
      color: var(--warning);
    }

    .rr-example.good {
      background: var(--success-20);
      color: var(--success);
    }

    .rr-card h3 {
      font-size: var(--text-lg);
      margin-bottom: var(--space-sm);
    }

    .rr-card p {
      color: var(--text-secondary);
      font-size: var(--text-sm);
    }

    /* CTA */
    .calc-cta-section {
      padding: var(--space-2xl) 0 var(--space-3xl);
    }

    .calc-cta-box {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-xl);
      padding: var(--space-2xl);
      background: var(--gray-900);
      border: 1px solid var(--gray-800);
      border-radius: var(--radius-xl);
    }

    @media (max-width: 768px) {
      .calc-cta-box {
        flex-direction: column;
        text-align: center;
      }
    }

    .cta-content h2 {
      font-size: var(--text-2xl);
      margin-bottom: var(--space-sm);
    }

    .cta-content p {
      color: var(--text-secondary);
    }

    .calc-cta-button {
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-md) var(--space-xl);
      background: var(--orange);
      color: var(--white);
      border-radius: var(--radius-md);
      font-weight: 700;
      font-size: var(--text-lg);
      text-decoration: none;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .calc-cta-button:hover {
      background: var(--orange-dark);
      transform: translateY(-2px);
    }

    .cta-arrow {
      transition: transform 0.3s;
    }

    .calc-cta-button:hover .cta-arrow {
      transform: translateX(4px);
    }
  </style>
</BaseLayout>
